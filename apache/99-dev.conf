##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##
##                                                                                                ##
##                                                                                                ##
##                                                                                                ##
##                                                                                                ##
##                                                                                                ##
##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##
##  IF
##   User-Agent string is of a web browser
##  THEN
##    Skip rules for known tools and known bots
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

RewriteCond %{ENV:UA_IS_WEB_BROWSER}                    "=1"

RewriteRule .* - [S=3]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP_USER_AGENT}  "=Wget"

  RewriteRule .* - [R=451,L,E=NOBOT:99000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP:X-Forwarded-For} "=127.0.0.1"
  RewriteCond %{HTTP:X-Real-IP}       "=127.0.0.1"

  RewriteCond %{HTTP_USER_AGENT}  "=curl/8.7.1"

  RewriteRule .* - [R=451,L,E=NOBOT:99000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (compatible; Baiduspider-render/2.0; +http://www.baidu.com/search/spider.html)" [OR]
  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Linux; Android 5.0) AppleWebKit/537.36 (KHTML, like Gecko) Mobile Safari/537.36 (compatible; TikTokSpider; ttspider-feedback@tiktok.com)"

  RewriteRule .* - [R=402,L,E=NOBOT:99998]


##
##
##
##  END OF SKIP
##
##
##


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##  EXPERIMENTAL
##
##  IMPORTANT
##  Return 403 for this rule! Not 451 yet!
##
##  Forbid HEAD requests from web browsers (to stop bots that evade all other checks).
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

RewriteCond %{REQUEST_METHOD}   "=HEAD"

RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"          [OR]
RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"          [OR]

RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36"                    [OR]

RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:122.0) Gecko/20100101 Firefox/122.0"                                     [OR]

RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:127.0) Gecko/20100101 Firefox/127.0"                                         [OR]
RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:146.0) Gecko/20100101 Firefox/146.0"                                         [OR]

RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (X11; Linux x86_64; rv:146.0) Gecko/20100101 Firefox/146.0"                                                   [OR]

RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (X11; Fedora; Linux x86_64; rv:125.0) Gecko/20100101 Firefox/125.0"                                           [OR]

RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (iPhone; CPU iPhone OS 16_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.7 Mobile/15E148 Safari/604.1"

RewriteRule .* - [R=403,L,E=NOBOT:99998]


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##  EXPERIMENTAL, DEBUGGING
##
##
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

##  AS14061 (DIGITALOCEAN-ASN), 162.243.0.0/17
RewriteCond %{REMOTE_ADDR}      "^162\.243\.([0-9]|[1-9][0-9]|1[01][0-9]|12[0-7])\."    [OR]

##  AS14061 (DIGITALOCEAN-ASN), 198.199.80.0/21
RewriteCond %{REMOTE_ADDR}      "^198\.199\.8[0-7]\."                                   [OR]

##  AS16509 (AMAZON-02),         18.117.0.0 - 18.119.255.255
RewriteCond %{REMOTE_ADDR}      "^18\.11[7-9]\."                                        [OR]

##  AS20473 (AS-VULTR),         66.135.0.0/19
RewriteCond %{REMOTE_ADDR}      "^66\.135\.([0-9]|[12][0-9]|3[01])\."                   [OR]

##  AS20473 (AS-VULTR),         140.82.0.0/20
RewriteCond %{REMOTE_ADDR}      "^140\.82\.([0-9]|1[0-5])\."                            [OR]

##  AS36352 (AS-COLOCROSSING),  172.245.92.0/24
RewriteCond %{REMOTE_ADDR}      "^172\.245\.92\."                                       [OR]

##  AS51396 (PFCLOUD),          176.65.148.0/24
RewriteCond %{REMOTE_ADDR}      "^176\.65\.148\."                                       [OR]

##  AS31898 (ORACLE-BMC-31898), 213.35.96.0/19
RewriteCond %{REMOTE_ADDR}      "^213\.35\.(9[6-9]|1[01][0-9]|12[0-7])\."               [OR]

##  AS203061 (itproximus),      169.239.203.0/24
RewriteCond %{REMOTE_ADDR}      "^169\.239\.203\."                                      [OR]

##  AS207990 (HR-CUSTOMER),     119.12.194.0/24
RewriteCond %{REMOTE_ADDR}      "^119\.12\.194\."                                       [OR]

##  AS207990 (HR-CUSTOMER),     119.12.205.0/24
RewriteCond %{REMOTE_ADDR}      "^119\.12\.205\."                                       [OR]

##  AS396982 (GOOGLE-CLOUD-PLATFORM), 35.225.112.0/20
RewriteCond %{REMOTE_ADDR}      "^35\.225\.(11[2-9]|12[0-7])\."                         [OR]

##  AS396982 (GOOGLE-CLOUD-PLATFORM), 130.211.224.0/20
RewriteCond %{REMOTE_ADDR}      "^130\.211\.(22[4-9]|23[0-9])\."

RewriteRule .* - [R=426,L,E=NOBOT:99999]
