##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##
##  DETECTION TYPE: Deterministic                                                                 ##
##  CLIENT ERROR RESPONSE: 451                                                                                    ##
##                                                                                                                ##
##  DESCRIPTION                                                                                                   ##
##                                                                                                                ##
##  @TODO                                                                                                         ##
##                                                                                                                ##
##                                                                                                                ##
##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##
##  IF
##    Request is whitelisted by the user
##    OR Accept starts with one of the values in the alternation
##    OR User-Agent is of search-engine bot
##  THEN
##    Skip all rules for Accept values
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

RewriteCond %{ENV:NOBOT_ALLOWED_BY_USER}                "=1"                    [OR]
RewriteCond %{ENV:UA_IS_SEARCH_ENGINE_BOT}              "=1"                    [OR]

RewriteCond %{HTTP:Accept}      "^(\*|application|image|text/css)"

RewriteRule .* - [S=21]


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##
##  ELSE IF
##    Accept is the one used by recent Chrome and browser is recent Chrome
##  THEN
##    Skip all subsequent rules for Accept values
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"

RewriteCond %{ENV:UA_IS_CHROME_110_TO_146}          "=1"

RewriteRule .* - [S=20]


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##
##  ELSE IF
##    Accept is the one used by Safari and recent Firefox and browser is Safari or recent Firefox
##  THEN
##    Skip all subsequent rules for Accept values
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"

RewriteCond %{ENV:UA_IS_FIREFOX_132_TO_149}          "=1"                       [OR]
RewriteCond %{ENV:UA_IS_SAFARI_10_TO_26}             "=1"

RewriteRule .* - [S=19]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  Accept value is unexpected.
  ##  - Should not start with colon.
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP:Accept}      "^:"

  RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_146}"

  RewriteRule .* - [R=451,L,E=NOBOT:63000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  IF
  ##    Accept has “application/signed-exchange”
  ##  THEN
  ##    Skip rules for Accept without “application/signed-exchange”
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP:Accept}      "application/signed-exchange"

  RewriteRule .* - [S=9]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##  RULE CONFIDENCE: 10
    ##  ANOMALY DETECTED: UNEXPECTED-Accept
    ##
    ##  - Accept-Encoding value is unexpected.
    ##    - It is from Internet Explorer 11, and Edge Legacy 15 and 16
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}          "=text/html, application/xhtml+xml, image/jxr, */*"

    RewriteCond %{ENV:UA_IS_CHROME_51_TO_129}           "=1"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  - Accept value is unexpected for root request.
    ##  - Accept-Encoding value is unexpected.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{REQUEST_URI}          "=/"
    RewriteCond %{HTTP:Accept}          "=text/html,application/xhtml+xml"

    RewriteCond %{HTTP:Accept-Encoding} "=gzip"

    RewriteCond %{HTTP_USER_AGENT}  "${MI_BROWSER_ON_CHR_112}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  Accept value is unexpected for root request.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{REQUEST_URI}      "=/"
    RewriteCond %{HTTP:Accept}      "=text/html"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_139}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##  RULE CONFIDENCE: 10
    ##  ANOMALY DETECTED: UNEXPECTED-Accept
    ##
    ##  Accept value is unexpected.
    ##  - It is sent by Chrome 30 to 58.
    ##  - It is sent by Firefox 72 to 92. (MDN seems to be off by one on this.)
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_80_TO_139}"                           [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_121}"                           [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_131}"                           [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_121}"                                [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_123}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  Accept value is unexpected for Safari, Firefox, and most versions of Chrome.
    ##  - It is from Chrome 59 to 73 (and some additional versions of Blink in Opera).
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_80_TO_149}"                           [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_78}"                                 [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_90_TO_149}"                          [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${INTERNET_EXPLORER_2_TO_10}"                  [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${SAFARI_DESKTOP_13_TO_14}"                    [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${SAFARI_MOBILE_13_TO_14}"                     [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${YANDEX_22_5_YOWSER_ON_CHR_100}"              [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${YANDEX_22_7_YOWSER_ON_CHR_102}"              [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${YANDEX_23_3_YOWSER_ON_CHR_110}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  Accept value is unexpected for Firefox and Safari, and for Chrome too.
    ##  - It is from Brave (Chrome value minus SXG).
    ##
    ##  NOTES
    ##  - For select sites, Brave identifies as Google Chrome in the client hint:
    ##    https://github.com/brave/brave-core/pull/29913
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_120}"                                 [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_120}"                           [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_120}"                                [OR]
    RewriteCond %{HTTP:Sec-CH-UA}   '"Google Chrome";v="131"'                       [OR]
    RewriteCond %{HTTP:Sec-CH-UA}   '"Google Chrome";v="138"'

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  Accept value is unexpected for these versions of Chrome and Edge.
    ##  - It is from Firefox 93 to 127.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_120_TO_139}"                          [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_145}"                                 [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_120}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##  RULE CONFIDENCE: 10
    ##
    ##  Accept value is unexpected.
    ##  - It is from Firefox (132 and newer) and Safari.
    ##  - It is from old versions of Chrome up to Chrome 29.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"

    RewriteCond %{ENV:UA_IS_CHROME_30_TO_149}               "=1"                    [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_85_ON_ANDROID_WV}"                    [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_120}"                           [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_136}"                           [OR]
    
    RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_124}"                                [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${OPERA_DESKTOP_88_ON_CHR_102}"                [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${OPERA_DESKTOP_94_ON_CHR_108}"                [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${OPERA_DESKTOP_117_ON_CHR_132}"               [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${OPERA_MOBILE_53_ON_CHR_74}"                  [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${OPPO_BROWSER_ON_CHR_66}"                     [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${QIHU_360EE_ON_CHR_41_TO_99}"                 [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${QIHU_360SE_ON_CHR_41_TO_99}"                 [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${QQ_BROWSER_10_ON_CHR_51_TO_99}"              [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${QUARK_BROWSER_3_4_ON_CHR_74}"                [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${UBROWSER_6_2_ON_CHR_74}"                     [OR]

    RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Linux; Android 9; MI 9 Build/PKQ1.181121.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/84.0.3883.76 Mobile Safari/537.36"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  Accept value is unexpected.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/markdown;q=1.0, text/x-markdown;q=0.9, text/plain;q=0.8, text/html;q=0.7, */*;q=0.1"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_143}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


  ##
  ##
  ##
  ##  END OF SKIP
  ##
  ##
  ##


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  IF
  ##    Accept does not have “application/signed-exchange”
  ##  THEN
  ##    Skip rules for Accept with “application/signed-exchange”
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP:Accept}      "!application/signed-exchange"

  RewriteRule .* - [S=7]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  Accept value is unexpected.
    ##  - It is not sent by any version of Chrome: Seems to be made-up.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/png,image/gif,image/jpg,*/*;q=0.8,application/signed-exchange;v=b3"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_75}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  Accept value is unexpected.
    ##  - Should not have spaces.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html, application/xhtml+xml, application/xml; q=0.9, image/webp, image/apng, */*; q=0.8, application/signed-exchange; v=b3; q=0.7"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_120}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##
    ##  Accept value is unexpected.
    ##  - It is from Chrome 74 to 78.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3"

    RewriteCond %{ENV:UA_IS_CHROME_80_TO_199}       "=1"                            [OR]
    RewriteCond %{ENV:UA_IS_FIREFOX_0_TO_125}       "=1"                            [OR]
    RewriteCond %{ENV:UA_IS_FIREFOX_100_TO_149}     "=1"                            [OR]
    RewriteCond %{ENV:UA_IS_SAFARI_10_TO_26}        "=1"                            [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_39}"                                  [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_122}"                           [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${YANDEX_23_1_YOWSER_ON_CHR_108}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##  RULE CONFIDENCE: 10
    ##
    ##  Accept value is unexpected.
    ##  - It is from Edge 80 to 109.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"

    RewriteCond %{ENV:UA_IS_CHROME_0_TO_69}                 "=1"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##  RULE CONFIDENCE: 10
    ##
    ##  Accept value is unexpected for Firefox, Safari, and most versions of Chrome.
    ##  - It is from Chrome 85 to 109.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"

    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_47}"                                  [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_130_TO_139}"                          [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_142}"                                 [OR]
    RewriteCond %{HTTP_USER_AGENT}  "${CHROME_143}"                                 [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${MQQ_BROWSER_8_7_ON_CHR_57}"                  [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${UC_BROWSER_11_9_ON_CHR_57}"                  [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${OPERA_5_TO_6}"                               [OR]

    RewriteCond %{HTTP_USER_AGENT}  "^Opera/9"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##  RULE CONFIDENCE: 10
    ##
    ##  Accept value is unexpected.
    ##  - It is from Chrome 110 and later.
    ##  - It is from Edge 121 and later.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"

    RewriteCond %{ENV:UA_IS_CHROME_0_TO_109}                "=1"                    [OR]
    RewriteCond %{ENV:UA_IS_FIREFOX}                        "=1"                    [OR]
    RewriteCond %{ENV:UA_IS_SAFARI}                         "=1"                    [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${CRIOS_IOS_11_TO_18_VER_ANY}"                 [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_115}"                           [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${INTERNET_EXPLORER_5_TO_10}"                  [OR]

    RewriteCond %{HTTP_USER_AGENT}  "${SEAMONKEY_2_0_TO_2_49}"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
    ##  RULE CONFIDENCE: 10
    ##
    ##  Accept value is unexpected.
    ##  - It is from Edge 110 to 120.
    ##
    ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

    RewriteCond %{HTTP:Accept}      "=text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"

    RewriteCond %{ENV:UA_IS_SAFARI}                         "=1"

    RewriteRule .* - [R=451,L,E=NOBOT:63000]


  ##
  ##
  ##
  ##  END OF SKIP
  ##
  ##
  ##


##
##
##
##  END OF SKIP
##
##
##
