##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##
##  DETECTION TYPE:                                                                               ##
##  CLIENT ERROR RESPONSE: 451                                                                    ##
##                                                                                                ##
##  DESCRIPTION                                                                                   ##
##                                                                                                ##
##  @TODO                                                                                         ##
##                                                                                                ##
##                                                                                                ##
##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##
##  IF
##    Request is whitelisted by the user
##  THEN
##    Skip the module
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

RewriteCond %{ENV:NOBOT_ALLOWED_BY_USER}                "=1"

RewriteRule .* - [S=6]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  Dead
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP_USER_AGENT}  "=everyfeed-spider/2.0 (http://www.everyfeed.com)"

  RewriteRule .* - [R=451,L,E=NOBOT:70000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  ##  Thus. Double space before URL.
  ##  2025-11-18. Domain is for sale.
  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (compatible; Exabot/3.0;  http://www.exabot.com/go/robot)"                                                    [OR]

  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"                                                             [OR]
  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)"                                         [OR]
  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36"                                                                  [OR]

  ##  https://searchengineland.com/msnbot-1-1-gives-way-to-bot-2-0-29276
  ##  Thus! With space after the opening parenthesis.
  RewriteCond %{HTTP_USER_AGENT}  "=msnbot/1.1 ( http://search.msn.com/msnbot.htm)"                                                                           [OR]
  
  RewriteCond %{HTTP_USER_AGENT}  "^msnbot/1\.0"                                                                                                              [OR]

  ##  2025-11-18. Link is 404. Homepage has nothing to do with RSS bots.
  RewriteCond %{HTTP_USER_AGENT}  "=YandoriRSSBot/3.0 (Go; +https://yandori.com/rssbot)"                                                                      [OR]

  ##  Spelling!
  RewriteCond %{HTTP_USER_AGENT}  "AppleNWebKit"

  RewriteRule .* - [R=451,L,E=NOBOT:70000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  Google Search does not send people to API endpoints to do user enumeration!
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP_REFERER}     "=https://www.google.com"
  RewriteCond %{REQUEST_URI}      "=/wp-json/wp/v2/users"                 [OR]
  RewriteCond %{QUERY_STRING}     "^author=\d+"
  RewriteRule .* - [R=451,L,E=NOBOT:70000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  Malformed UA (User-Agent) strings
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  ##  Note the ,2 substring.
  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (iPad; CPU OS 15_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.6,2 Mobile/15E148 Safari/604.1"     [OR]

  ##  Misses parts.
  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/91.0.4472.124"                                                    [OR]

  ##  MOBLIE
  RewriteCond %{HTTP_USER_AGENT}  "Moblie Safari/537\.36$"                                            [OR]

  ##  Chrome version is truncated.
  RewriteCond %{HTTP_USER_AGENT}  "Chrome/79\.0 Safari/[^ ]+$"                                        [OR]
  RewriteCond %{HTTP_USER_AGENT}  "Chrome/115\.0 Safari/[^ ]+$"                                       [OR]
  RewriteCond %{HTTP_USER_AGENT}  "Chrome/120 Safari/[^ ]+$"                                          [OR]
  RewriteCond %{HTTP_USER_AGENT}  "Chrome/124\.0\.0 Safari/[^ ]+$"

  ##
  ##  REWRITE RULE
  ##

  RewriteRule .* - [R=451,L,E=NOBOT:70000]


  ##
  ##
  ##
  ##  PROXIES
  ##
  ##
  ##


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  Specific, old UAs coming through proxies
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP:X-Forwarded-For}     "!^$"
  RewriteCond %{HTTP:X-Forwarded-Proto}   "!^$"
  RewriteCond %{HTTP_USER_AGENT}          "=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.127 Safari/537.36"
  RewriteRule .* - [R=451,L,E=NOBOT:70000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  Requests specific path or file in a way unexpected for a web browser
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{REQUEST_METHOD}   "=HEAD"
  RewriteCond %{REQUEST_URI}      "/wp-content/(plugins|themes)/.*\.(css|js|txt)$"

  RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_146}"

  RewriteRule .* - [R=451,L,E=NOBOT:70000]


##
##
##
##  END OF SKIP
##
##
##
