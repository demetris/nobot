##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##
##  DETECTION TYPE: Deterministic                                                                 ##
##  CLIENT ERROR RESPONSE: 451                                                                    ##
##                                                                                                ##
##  DESCRIPTION                                                                                   ##
##                                                                                                ##
##  Response for requests with various discrepancies and impossibilities in HTTP header fields    ##
##                                                                                                ##
##                                                                                                ##
##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##
##  IF
##    Request is whitelisted by the user
##    OR User-Agent string is of a search-engine bot
##  THEN
##    SKIP all rules in this module
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

RewriteCond %{ENV:NOBOT_ALLOWED_BY_USER}                "=1"                    [OR]
RewriteCond %{ENV:UA_IS_SEARCH_ENGINE_BOT}              "=1"

RewriteRule .* - [S=5]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##  TEMPORARY
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP_USER_AGENT}  "=Wget"

  RewriteRule .* - [R=451,L,E=NOBOT:60000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##  CONFIDENCE: TBD
  ##
  ##  Accept value is unexpected for root request.
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{REQUEST_URI}          "=/"
  RewriteCond %{HTTP:Accept}          "=*/*"

  RewriteCond %{HTTP_USER_AGENT}  "${CHROME_91}"

  RewriteRule .* - [R=451,L,E=NOBOT:60000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##  CONFIDENCE: 10
  ##  UNEXPECTED-Encoding-UNEXPECTED-Language
  ##
  ##  - Accept-Encoding value is unexpected. Should have “sdch”.
  ##  - Accept-Language value is unexpected. Quality factor should be 0.8.
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{HTTP:Accept-Encoding} "=gzip, deflate"
  RewriteCond %{HTTP:Accept-Language} "=en-US,en;q=0.5"

  RewriteCond %{HTTP_USER_AGENT}  "${CHROME_31}"

  RewriteRule .* - [R=451,L,E=NOBOT:60000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##  CONFIDENCE: TBD
  ##
  ##  Sec-Fetch-Dest value is unexpected for visit from Google Search.
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{REQUEST_SCHEME}       "=https"
  RewriteCond %{HTTP:Sec-Purpose}     "^$"
  RewriteCond %{HTTP_REFERER}         "=https://www.google.com/"
  RewriteCond %{HTTP:Sec-Fetch-Dest}  "=empty"

  RewriteCond %{HTTP_USER_AGENT}  "${CHROME_143}"

  RewriteRule .* - [R=451,L,E=NOBOT:60000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##  CONFIDENCE: 9
  ##
  ##  Sec-CH-UA is missing in document request while three fields for fetch metadata are present.
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{REQUEST_SCHEME}       "=https"
  RewriteCond %{REQUEST_URI}          "=/"
  RewriteCond %{HTTP:Accept}          "=text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"
  RewriteCond %{HTTP:Sec-CH-UA}       "^$"
  RewriteCond %{HTTP:Sec-Fetch-Dest}  "!^$"
  RewriteCond %{HTTP:Sec-Fetch-Mode}  "!^$"
  RewriteCond %{HTTP:Sec-Fetch-Site}  "!^$"

  RewriteCond %{HTTP_USER_AGENT}      "${CHROME_129}"

  RewriteRule .* - [R=451,L,E=NOBOT:60000]


##
##
##
##  END OF SKIP
##
##
##
