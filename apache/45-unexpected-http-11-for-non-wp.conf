##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##
##  DETECTION TYPE: Deterministic                                                                 ##
##  CLIENT ERROR RESPONSE: 451                                                                    ##
##                                                                                                ##
##  NOTICE                                                                                        ##
##                                                                                                ##
##  NOT FOR ALL WEB SERVER CONFIGURATIONS!                                                        ##
##  ONLY include this module if HTTP/2 is enabled on the web server.                              ##
##  ONLY include this module if the website does NOT use WordPress.                               ##
##                                                                                                ##
##  DESCRIPTION                                                                                   ##
##                                                                                                ##
##  Response for requests that use HTTP/1.1 over TLS                                              ##
##  even though the agent supports HTTP/2 according to the User-Agent field,                      ##
##  and that request WordPress paths on a non-WordPress website                                   ##
##                                                                                                ##
##                                                                                                ##
##  ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----    ----  ##


##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
##
##  IF
##    Request is whitelisted by the user
##    OR User-Agent is of a search-engine bot
##    OR HTTP protocol is HTTP/2
##  THEN
##    Skip all rules in this module
##
##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

RewriteCond %{ENV:NOBOT_ALLOWED_BY_USER}                "=1"                    [OR]
RewriteCond %{ENV:UA_IS_SEARCH_ENGINE_BOT}              "=1"                    [OR]
RewriteCond %{SERVER_PROTOCOL}  "=HTTP/2.0"

RewriteRule .* - [S=3]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{REQUEST_SCHEME}   "=https"
  RewriteCond %{SERVER_PROTOCOL}  "=HTTP/1.1"
  RewriteCond %{REQUEST_URI}      "^/wp-admin/"

  RewriteCond %{HTTP_USER_AGENT}  "${CHROME_100_TO_129}"                          [OR]

  RewriteCond %{HTTP_USER_AGENT}  "${EDGE_DESKTOP_100_TO_129}"                    [OR]

  RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_100_TO_129}"                         [OR]

  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Safari/605.1.15"                    [OR]
  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.1 Safari/605.1.15"                    [OR]
  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (Macintosh; Intel Mac OS X 13_6_1) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/17.2 Safari/605.1.15"                     [OR]

  RewriteCond %{HTTP_USER_AGENT}  "=Mozilla/5.0 (iPhone; CPU iPhone OS 18_3_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) GSA/362.0.741018905 Mobile/15E148 Safari/604.1"

  RewriteRule .* - [R=451,L,E=NOBOT:45000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{REQUEST_SCHEME}   "=https"
  RewriteCond %{SERVER_PROTOCOL}  "=HTTP/1.1"
  RewriteCond %{REQUEST_URI}      "^/wp-login\.php"

  RewriteCond %{HTTP_USER_AGENT}  "${CHROME_90_TO_129}"                           [OR]

  RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_100_TO_129}"                         [OR]

  RewriteCond %{HTTP_USER_AGENT}  "${OPERA_DESKTOP_106_ON_CHR_120}"               [OR]

  RewriteCond %{HTTP_USER_AGENT}  "${SAFARI_DESKTOP_16}"                          [OR]
  RewriteCond %{HTTP_USER_AGENT}  "${SAFARI_DESKTOP_17}"

  RewriteRule .* - [R=451,L,E=NOBOT:45000]


  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -
  ##
  ##
  ##
  ##  - - - - - - - - - - - - - - - - - ---- - - - - - - - - - - - - - - - - - - -

  RewriteCond %{REQUEST_SCHEME}   "=https"
  RewriteCond %{SERVER_PROTOCOL}  "=HTTP/1.1"
  RewriteCond %{REQUEST_URI}      "^/xmlrpc\.php"

  RewriteCond %{HTTP_USER_AGENT}  "${CHROME_100_TO_129}"                          [OR]

  RewriteCond %{HTTP_USER_AGENT}  "${FIREFOX_100_TO_129}"

  RewriteRule .* - [R=451,L,E=NOBOT:45000]


##
##
##
##  END OF SKIP
##
##
##
